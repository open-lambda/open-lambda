#!/bin/sh
# lspgpot - script to extract the ownertrust values
# from PGP keyrings and list them in GnuPG ownertrust format.
#
# This file is free software; as a special exception the author gives
# unlimited permission to copy and/or distribute it, with or without
# modifications, as long as this notice is preserved.
#
# This program is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY, to the extent permitted by law; without even the
# implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

if ! gpg --version > /dev/null 2>&1 ; then
   echo "GnuPG not available!"
   exit 1
fi

gpg --dry-run --with-fingerprint --with-colons $* | awk '
BEGIN { FS=":"
	printf "# Ownertrust listing generated by lspgpot\n"
	printf "# This can be imported using the command:\n"
	printf "#    gpg --import-ownertrust\n\n"  }
$1 == "fpr" { fpr = $10 }
$1 == "rtv" && $2 == 1 && $3 == 2 { printf "%s:3:\n", fpr; next }
$1 == "rtv" && $2 == 1 && $3 == 5 { printf "%s:4:\n", fpr; next }
$1 == "rtv" && $2 == 1 && $3 == 6 { printf "%s:5:\n", fpr; next }
'
